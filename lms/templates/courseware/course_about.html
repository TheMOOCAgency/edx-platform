<%namespace name='static' file='../static_content.html'/>
<%!
from django.utils.translation import ugettext as _
from django.core.urlresolvers import reverse
from courseware.courses import get_course_about_section
from django.conf import settings
from edxmako.shortcuts import marketing_link
from openedx.core.lib.courses import course_image_url
from lms.djangoapps.grades.new.course_grade import CourseGradeFactory
from opaque_keys.edx.locations import SlashSeparatedCourseKey
from courseware.courses import (
    get_course_by_id,
)

%>

<%inherit file="../main.html" />
<%block name="headextra">
  ## OG (Open Graph) title and description added below to give social media info to display
  ## (https://developers.facebook.com/docs/opengraph/howtos/maximizing-distribution-media-content#tags)
  <meta property="og:title" content="${course.display_name_with_default_escaped}" />
  <meta property="og:description" content="${get_course_about_section(request, course, 'short_description')}" />
</%block>
<%
dashboard = static.get_value('css_overrides_dashboard')
%>
% if not dashboard:
  <link rel="stylesheet" type="text/css" href="${static.url('css/dashboard.css')}">
% else:
  <link rel="stylesheet" type="text/css" href="${static.url(dashboard)}" />
% endif
<%
course_about = static.get_value('css_overrides_course_about')
%>
% if not course_about:
  <link rel="stylesheet" type="text/css" href="${static.url('css/course_about.css')}">
% else:
  <link rel="stylesheet" type="text/css" href="${static.url(course_about)}" />
% endif

<script src="${static.url('js/course_about_atp.js')}"></script>
<section id="course_about_contenair">
<section id="course_about_up_content">
<section id="atp_ariane_about">
	<span>${_("Explore courses")}</span><span> > ${_(categ)}</span>
</section>
<section id="atp_about_course_card">
<ul class="atp_course_listing">

<%
course_factory = CourseGradeFactory().create(request.user, course)
%>
% if status == 0:
    <% atp_rank = 'invite'  %>
% elif status > 0 and course_factory.passed == False:
    <% atp_rank = 'cours' %>
% elif status > 0 and course_factory.passed == True:
    <% atp_rank = 'finish'  %>
% endif
<% course_about = 1 %>
<% course_about_name = course.display_name_with_default_escaped %>
<% course_about_link = '/courses/'+str(course.id)+'/' %>
<% course_about_id = str(course.id) %>
<% course_about_img = str(course_image_urls['large']) %>
<% course_progression = status %>
<% compteur = 0 %>
<% can_unenroll = False %>
<% credit_status = False %>
<% show_email_settings = False %>
<% course_mode_info = False %>
<% show_refund_option = False %>
<% is_paid_course = False %>
<% is_course_blocked = False %>
<% course_verification_status = False %>
<% course_requirements = False %>
<% show_courseware_link = '/courses/'+str(course.id)+'/' %>
<% duration = get_course_about_section(request, course, "effort")  %>
<% course_tma = get_course_by_id(course.id) %>
<% content_data = course_tma.content_data %>
<%include file='../dashboard/_dashboard_course_listing.html' args='categ=categ,content_data=content_data,required=required,duration=duration,course_about_link=course_about_link,course_about_id=course_about_id,course_about_img=course_about_img,course_about_name = course_about_name,course_about = course_about,course_progression = course_progression,compteur=compteur,atp_rank=atp_rank,course_overview=course_tma, enrollment=False, show_courseware_link=False, cert_status=False, can_unenroll=can_unenroll, credit_status=credit_status, show_email_settings=show_email_settings, course_mode_info=course_mode_info, show_refund_option=show_refund_option, is_paid_course=is_paid_course, is_course_blocked=is_course_blocked, verification_status=False, course_requirements=False, dashboard_index=False, share_settings=False, user=user, related_programs=False, display_course_modes_on_dashboard=True' />
<span style="display:block;clear:left;"></span>
</ul>
</section>
<section id="atp_about_desc">

<h1>${course.display_name_with_default_escaped}</h1>
<p id="course_about_accroche">${get_course_about_section(request, course, 'short_description')}</p>
<div id="course_about_details">
 <ul>
<% course_start_date = course.start %>
  <li><span>${_("Starting date")} :</span> <span>${course_start_date.strftime('%Y-%m-%d')}</span></li>
  <li><span>${_("Ending date")} :</span> <span>
% if get_course_about_section(request, course, "end_date") or course.end:
   % if get_course_about_section(request, course, "end_date"):
      ${get_course_about_section(request, course, "end_date")}
   % else:
      ${course.end.strftime('%Y-%m-%d')}
   % endif
%endif
  </span></li>
 </ul>
 <ul id="course_about_ul">
  <li><span>${_("Langue")} :</span> <span id="${course_details.language}">${course_details.language}</span></li>
  <li><span>${_("Statut")} :</span> <span>
% if atp_rank == 'invite':
    ${_("To start")}
% elif atp_rank == 'cours':
    ${_("In progress")}
% else:
    ${_("Finished")}
% endif
</span></li>
 </ul>
% if course_factory.passed:
<ul id="course_about_ul">
 <li><span>${_("Score")} :</span> <span id="${course_details.language}">${str(course_factory.percent * 100)+'%'}</span></li>
 <li><a href="#" id="certiticate"><img src="${static.url('images/pdf.svg')}" class="svg"/> ${_('Download the certificate')}</a></li>
</ul>
% endif
 <span style="clear:left;display:block;"></span>
</div>
<div class="details">
% if staff_access and studio_url is not None:
 <div class="wrap-instructor-info studio-view">
  <a class="instructor-info-action" href="${studio_url}">${_("View About Page in studio")}</a>
 </div>
% endif
 <div class="inner-wrapper">
   ${get_course_about_section(request, course, "overview")}
 </div>
</section>
<span style="display:block;clear:both;"></span>
</section>
<section id="course_about_atp_end">
 <img src="${static.url('images/pdf.svg')}" id="encoche_course_about"/>
 <h2>${_("Format Modules")}</h2>
 <div id="picto_course_about">
   <div class="atp_course_picto">
% if content_data.get('document_pdf'):
<div class="dashboard_picto_tuto_tma">
<img src="${static.url('images/pdf.svg')}" class="svg"/>
<span>${_("document pdf")}</span>
</div>
% endif
% if content_data.get('webzine'):
<div class="dashboard_picto_tuto_tma">
<img src="${static.url('images/webzine.svg')}" class="svg"/>
<span>${_("webzine")}</span>
</div>
% endif
% if content_data.get('quiz'):
<div class="dashboard_picto_tuto_tma">
<img src="${static.url('images/quiz.svg')}" class="svg"/>
<span>${_("quiz")}</span>
</div>
% endif
% if content_data.get('video'):
<div class="dashboard_picto_tuto_tma">
<img src="${static.url('images/video.svg')}" class="svg"/>
<span>${_("video")}</span>
</div>
% endif
% if content_data.get('serious_game'):
<div class="dashboard_picto_tuto_tma">
<img src="${static.url('images/seriousgame.svg')}" class="svg"/>
<span>${_("serious game")}</span>
</div>
% endif
% if content_data.get('text_image'):
<div class="dashboard_picto_tuto_tma">
<img src="${static.url('images/testes&images.svg')}" class="svg"/>
<span>${_("text & images")}</span>
</div>
% endif
   </div>
 </div>
</section>
</section>
<script>
$(document).scroll(function(){
  var scroll_h = $(this).scrollTop();
  if(scroll_h >= 90) {
    $('.atp_course_info').hide();
    $('.atp_course_picto').hide();
    $('.atp_course_image').slideUp(1000);
    $('.atp_course_title').css('padding-top','10px');
    $('.atp_course_title').css('padding-bottom','10px');
  }else{
    $('.atp_course_info').show();
    $('.atp_course_picto').show();
    $('.atp_course_image').slideDown(1000);
    $('.atp_course_title').attr('style','');
  }
})
% if course_factory.passed:
$('#certiticate').click(function(e){
  e.preventDefault();
  var course_id = '${course.id}';
  var url = '/api/atp/check/certificate/${course.id}/';
  $.ajax({
    url:url,
    type:'GET',
    dataType:'json',
    success:function(data){
      window.open(data.certificate_url,'_self');
    }
  })
})
% endif
</script>
